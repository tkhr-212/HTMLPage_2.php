<!DOCTYPE html>

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>掲示板</title>
</head>
<body>

    <?php
    $filename="HTML.txt";
    $fp=fopen($filename,"a");

    $name=$_POST["name"];
    $comment=$_POST["comment"];
    $count=0;

    $lines = file($filename);

    foreach($lines as $line)
    {
         $numbercount = explode("<>", $line);
         if($numbercount[0] > $count){
             $count = $numbercount[0];
         }
     }
     $num = $count + 1;
    
    
    if(empty($name)==false&&empty($comment)==false)
    {
        fwrite($fp, $num."<>".$name."<>".$comment."<>" . PHP_EOL);
    }
    fclose($fp);

    if(isset($_POST["delete"]))
    {
        $delete=$_POST["delete"];

        $deletefile=file($filename);
        $fp=fopen($filename,"w");

        foreach($deletefile as $df)
        {
            $deletenumber=explode("<>",$df);
            if($deletenumber[0]!=$delete)
            {
            fwrite($fp,$df);
            }
        }
     fclose($fp);
    }
    ?>

<section>
<h1>掲示板</h1>

    <br>
    【名前を入力】
    <br>

<form action="" method="post">
    <input type="text" name="name" value="">

    <br><br>
    【本文を入力】
    <br>
        <input type="text" name="comment" value="">
    <br>

    <input type="submit" name="submit" value="投稿する">

    </form>

    <form action="" method="post">
    <br><br>
    【削除したい文の番号を選んでください】
    <br>

    
    <input type="number" name="delete" value="">

    <input type="submit" name="submit" value="削除する">

    </section>

    <section>
    <h2>投稿一覧</h2>
    </section>
    </form>

    <?php
    $displaydata=file($filename);

    foreach($displaydata as $dd)
    {
        $data=explode("<>",$dd);

        echo "番号:".$data[0]
        ."名前:".$data[1]
        ."<br>"
        ."本文:".$data[2]
        ."<br>";
    }
    ?>


</body>
</html>
